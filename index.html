<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css?v=2.0.0">
    <link rel="stylesheet" href="./css/index1.css?v=1.0.0">
    <link rel="stylesheet" href="./css/music/iconfont.css">

</head>
<body>
    <!-- 粒子动效库 -->
    <div id="particles-js" ></div>
    <script src="js/particles.js-master/particles.js"></script>
    <script src="js/particles.js-master/app.js"></script>


    <!-- 导航栏 -->
    <div id="Navigation-bar">
        <ul class="ul1">
            <li><a href="./index.html" class="a1" id="index">主页</a></li>
            <li><a href="./hobby.html" class="a1" id="hobby">兴趣爱好</a></li>
            <li><a href="./knowledge.html" class="a1" id="knowledge">学习总结</a></li>
            <li><a href="./Project-Experience.html" class="a1" id="Project-Experience">项目经历</a></li>
            <li><a href="./Important-documents.html" class="a1" id="Important-documents">工作文件</a></li>
        </ul>
    </div>

    <!--展栏1 -->
    <div id="exhibit1">
        <div id="music">
            <audio src="" id="myaudio"></audio>
            <div id="music-info">
                <div id="music-img">
                    <img src="./image/music-img/下雨天-南拳妈妈.jpg" alt="下雨天-南拳妈妈" width="100%" height="100%">
                </div>
                <div class="music-text" id="music-text" style="display: block;">
                    <div id="textpart">
                        <div id="music-title">
                            <p>下雨天</p>
                        </div>
                        <div id="music-author">
                            <p>南拳妈妈</p>
                        </div>
                        <div id="music-lyrics">
                            <p></p>
                        </div>
                    </div>
                    <div id="music-progress">
                        <div id="music-progress-time">
                            <span id="starttime">00:00</span>
                            <span id="endtime">05:39</span>
                        </div>
                        <div id="music-progress-bar">
                            <div id="music-progress-line"></div>
                        </div>
                    </div>
                </div>
                <div class="music-list" id="music-list" style="display: none;">
                    <div id="music-list-top">
                        <div id="music-list-title">
                            <span>歌曲列表</span>
                        </div>
                    </div>
                    <div id="music-list-form">
                        <ul id="music-list-content" >
                            
                        </ul>
                    </div>
                </div>
            </div>
            <div id="music-panel">
                <span class="iconfont icon-shangyishouge" id="icon-shangyishouge" style="margin-right: 2%;" ></span>
                <span class="iconfont icon-bofang" id="icon-bofang" style="margin-right: 2%;"></span>
                <span class="iconfont icon-xiayishou" id="icon-xiayishou" style="margin-right: 10%;" ></span>
                <span class="iconfont icon-zhongdengyinliang" id="icon-guanbishengyin"  style="margin-right: 5%;" ></span>
                <span class="iconfont icon-gedan" id="icon-gedan"  ></span>
            </div>
        </div>
        <div id="photo"></div>
    </div>

    <!-- 展栏2 -->
    <div id="exhibit2">
        <div class="exhibit2" id="hobby">hobby</div>
        <div class="exhibit2" id="knowledge">knowledge</div>
        <div class="exhibit2" id="Project-Experience">Project-Experience</div>
        <div class="exhibit2" id="Important-documents">Important-documents</div>
        <div class="exhibit2"></div>
    </div>


    <!-- 不同设备盒子、字体比例问题 -->
    <script type="text/javascript">
        var phoneWidth =  parseInt(window.screen.width);
        var phoneScale = phoneWidth/640;
        var ua = navigator.userAgent;
        if (/Android (\d+\.\d+)/.test(ua)){
            var version = parseFloat(RegExp.$1);
            if(version>2.3){
                document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">');
            }else{
                document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
        }
    </script>
    <!-- 音乐面板功能 -->
    <script type="text/javascript" src="./js/music-contro.js"></script>

    <!-- 加载音乐列表信息 -->
    <script type="text/javascript" src="./js/jquery/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="./music.json"></script>
    <script>
        // 空列表等待传入
        var musiclist = []
        // 当前音乐
        var initmusic = 0
        $.ajax({
            type: "GET",
            url: "./music.json",
            dataType: "json",
            success: function(data){
                musiclist = data
                render(data[initmusic]);
                renderMusicList(musiclist)
            },
        })
        // 设置标签对应的内容 对号入座
        function render(data){
            $("#music-title").html(data.name)
            $("#music-author").html(data.singer)
            $("#endtime").html(data.time)
            $('#music-img img').attr('src',data.img)
            $('audio').attr('src',data.url)
        }
        // 给上一首按钮绑定点击事件
        $('#icon-shangyishouge').on('click',function(){
            if (initmusic <= 0) {
                initmusic = musiclist.length-1;
            }else{
                initmusic--;
            }
            console.log(initmusic);
            render(musiclist[initmusic])
            $("audio").get(0).play()
            $('#icon-bofang').removeClass().addClass('iconfont icon-zanting')
            renderMusicList(musiclist)
        })
        // 给下一首按钮绑定点击事件
        $('#icon-xiayishou').on('click',function(){
            if (initmusic < musiclist.length-1) {
                initmusic += 1;
            }else{
                initmusic = 0;
            }
            render(musiclist[initmusic])
            $("audio").get(0).play()
            $('#icon-bofang').removeClass().addClass('iconfont icon-zanting')
            renderMusicList(musiclist)
        })
        // 给播放按钮绑定点击事件
        $('#icon-bofang').on("click",function(){
            //修改播放暂停图标
            if ($("audio").get(0).paused) {
                // 播放音乐
                $("audio").get(0).play()
                $(this).removeClass().addClass('iconfont icon-huanchong')
                var timesRun = 0;
                var interval =setInterval(function(){
                    timesRun+=1
                    if(timesRun === 15){    
                        clearInterval(interval);    
                    }
                    if (Boolean($("audio").get(0).currentTime)) {
                        clearInterval(interval);
                    }
                }, 1000);
                $(this).removeClass().addClass('iconfont icon-zanting')
                renderMusicList(musiclist)
            }else{
                $(this).removeClass().addClass('iconfont icon-bofang')
                // 暂停音乐
                $("audio").get(0).pause()
            }
                

        })
        // 给歌单按钮绑定点击事件
        $(".icon-gedan").on("click",function(){
            if($('.music-text').attr('style') == 'display: block;'){
                $('.music-text').attr('style','display: none;') 
                $('.music-list').attr('style','display: block;')
            }else{
                $('.music-text').attr('style','display: block;') 
                $('.music-list').attr('style','display: none;') 
            }
            renderMusicList(musiclist)
        })
        // 给静音按钮绑定点击事件
        $("#icon-guanbishengyin").on("click",function () {
            if ($(this).hasClass("icon-zhongdengyinliang")) {
                // 关闭声音
                $(this).removeClass().addClass('iconfont icon-guanbishengyin')
                $("audio").get(0).muted = true
            }else{
                $(this).removeClass().addClass('iconfont icon-zhongdengyinliang')
                $("audio").get(0).muted = false
            }
        })
        // 给进度条时间绑定更新事件
        $("audio").on("timeupdate",function () {
            // 获取音乐当前时间
            var currentTime = $("audio").get(0).currentTime || 0;
            // 获取音乐总时长
            var duration = $("audio").get(0).duration || 0;
            // 设置当前时间
            $("#starttime").html(formatTime(currentTime))
            // 设置进度条
            value = (duration - currentTime) / 100
            $("#music-progress-line").css({
                width:value + '%'
            })
        })
        function formatTime(time) {
            // 格式化时间
            var min = parseInt(time / 60) ; 
            var sec = parseInt(time % 60);
            min = min < 10 ? '0'+min : min
            sec = sec < 10 ? '0'+sec : sec
            return `${min}:${sec}`
        }
        // 歌单遍历
        function renderMusicList(list) {
            $("#music-list-content").empty();
            $.each(list,function (index,item) {
                var $li = $(`
                    <li class='${index == initmusic ? 'current-playlist' : ' ' }'>
                        <span data-index='${index}' >${index + 1} .${item.name} - ${item.singer}</span>
                    </li>
                `)
                console.log(initmusic);
                $("#music-list-content").append($li)
            })
        }
        // 歌单点击
        $("#music-list-content ").on('click','span',function () {
            render(musiclist[$(this).attr('data-index')])
            console.log(initmusic);
            $('#icon-bofang').trigger('click')
        })
        
    </script>
</body>
</html>